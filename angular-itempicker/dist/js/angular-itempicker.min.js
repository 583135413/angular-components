angular.module("ui.itempicker",["ui.checkbox"]).directive("angularItempicker",[function(){return{restrict:"AE",scope:{options:"=options"},template:'<div class="angular-itempicker">   <div class="list-wrap source-list-wrap">       <div class="search-box" ng-if="::settings.showSearch">           <div class="search-item">               <input type="text" ng-model="searchSourceName" class="form-control search-box-input" placeholder="{{::settings.searchPlaceholder}}">           </div>       </div>       <div class="select-all">           <angular-checkbox on-check="toggleAllSourceList()" ng-disabled="sourceListFiltered.length === 0" ng-model="isSelectAllSourceList" default-value="false" target-value="true" check-text="{{sourceListFiltered.length}}条"></angular-checkbox>       </div>       <div class="list source-list">           <div class="item" ng-repeat="item in options.sourceList | filter:getSourceFilter() as sourceListFiltered">               <angular-checkbox on-check="checkItemSourceList()" ng-model="item.checked" default-value="false" target-value="true" check-text="{{::item[settings.value]}}" ></angular-checkbox>           </div>       </div>   </div>   <div class="tool-btn-wrap">       <button type="button" class="btn" ng-click="pushToRight()" title="左移"><span class="icon icon-chevron-right"></span></button>       <button type="button" class="btn" ng-click="pushToLeft()" title="右移"><span class="icon icon-chevron-left"></span></button>   </div>   <div class="list-wrap target-list-wrap">       <div class="search-box" ng-if="::settings.showSearch">           <div class="search-item">               <input type="text" ng-model="searchTargetName" class="form-control search-box-input" placeholder="{{::settings.searchPlaceholder}}">           </div>       </div>       <div class="select-all">           <angular-checkbox  on-check="toggleAllTargetList()" ng-disabled="targetListFiltered.length === 0" ng-model="isSelectAllTargetList" default-value="false" target-value="true" check-text="{{targetListFiltered.length}}条"></angular-checkbox>       </div>       <div class="list target-list">           <div class="item" ng-repeat="item in options.targetList | filter:getTargetFilter() as targetListFiltered">               <angular-checkbox on-check="checkItemTargetList()" ng-model="item.checked" default-value="false" target-value="true" check-text="{{::item[settings.value]}}"></angular-checkbox>           </div>       </div>   </div></div>',link:function(e,t,i){var s=e.settings=angular.extend({key:"id",value:"name",showSearch:!0,searchPlaceholder:"请输入搜索内容"},e.options.settings),c=s.key;e.sourceListFiltered=[],e.targetListFiltered=[],e.isSelectAllSourceList=!1,e.isSelectAllTargetList=!1,e.getSourceFilter=function(){var t={};return t[s.value]=e.searchSourceName,t},e.getTargetFilter=function(){var t={};return t[s.value]=e.searchTargetName,t};var l=function(){e.isSelectAllSourceList=!1;for(var t=0;t<e.options.sourceList.length;t++)e.options.sourceList[t].checked=!1},r=function(){e.isSelectAllTargetList=!1;for(var t=0;t<e.options.targetList.length;t++)e.options.targetList[t].checked=!1};e.toggleAllSourceList=function(){e.isSelectAllSourceList?angular.forEach(e.sourceListFiltered,function(e){e.checked=!0}):l()},e.toggleAllTargetList=function(){e.isSelectAllTargetList?angular.forEach(e.targetListFiltered,function(e){e.checked=!0}):r()},e.checkItemSourceList=function(){for(var t=0;t<e.sourceListFiltered.length;t++)if(!e.sourceListFiltered[t].checked)return void(e.isSelectAllSourceList=!1);e.isSelectAllSourceList=!0},e.checkItemTargetList=function(){for(var t=0;t<e.targetListFiltered.length;t++)if(!e.targetListFiltered[t].checked)return void(e.isSelectAllTargetList=!1);e.isSelectAllTargetList=!0},e.pushToRight=function(){var t=[];if(angular.forEach(e.sourceListFiltered,function(e){e.checked&&t.push(e)}),t.length>0){e.searchTargetName="",e.options.targetList=e.options.targetList.concat(angular.copy(t));for(var i=e.options.sourceList,s=0;s<t.length;s++)for(var a=t[s][c],o=0;o<i.length;o++)a===i[o][c]&&i.splice(o,1);l(),r()}},e.pushToLeft=function(){var t=[];if(angular.forEach(e.targetListFiltered,function(e){e.checked&&t.push(e)}),t.length>0){e.options.sourceList=e.options.sourceList.concat(angular.copy(t));for(var i=e.options.targetList,s=0;s<t.length;s++)for(var a=t[s][c],o=0;o<i.length;o++)a===i[o][c]&&i.splice(o,1);l(),r()}}}}}]);