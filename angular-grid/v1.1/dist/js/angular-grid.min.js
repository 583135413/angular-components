angular.module("ui.grid",["ngDatetime"]).factory("TableHelper",[function(){var t={};return t.throttle=function(t,e){var n=null;return function(){var a=this,i=arguments;clearTimeout(n),n=setTimeout(function(){t.apply(a,i)},e)}},t}]).factory("TableFactory",["$http","TableHelper","$rootScope","$timeout",function(t,e,n,a){var i={};return i.defaultSettings={checkbox:!1},i.createTable=function(t,e){var n=angular.extend({},i.defaultSettings,t.settings),t=t.options;if(!e||0===e.length)return{tableList:[]};var a={};for(var l in e[0])e[0].hasOwnProperty(l)&&!t[l]&&(a[l]={hidden:!0});t=angular.extend({},t,a);var r=function(){var e={};for(var n in t)angular.isFunction(t[n].hidden)&&(t[n].hidden=t[n].hidden()||!1),e[n]=angular.extend({},t[n]);return e},o=function(e){var n={};for(var a in t)n[a]=e[a];return n},s=function(){for(var t=[],n=0;n<e.length;n++){var a=o(e[n]);c(a),t.push(a)}return t},c=function(e){for(var n in t)t[n].cellTemplate&&(e[n]=t[n].cellTemplate())},d={_watcherId:(new Date).getTime(),tableSettings:n,tableOptions:r(),tableList:s()};return d},i}]).filter("tdTrans",["TableHelper","dateTimeFactory",function(t,e){return function(t,n){var a=null===t||""===t;if(n.transValue){var i;if(angular.isFunction(n.transValue)){for(var l=n.transValue(),r={},o=l.list,s=l.key,c=l.value,d=0;d<o.length;d++)r[o[d][s]]=o[d][c];i=r[t]}else i=n.transValue[t];t=i||"-"}if(n.formatDate)try{t=e.format(e.newDate(t),n.formatDate)}catch(u){t="-"}if(n.toFixed)try{t=angular.isNumber(Number(t))&&!angular.equals(NaN,Number(t))?Number(t).toFixed(n.toFixed):"-"}catch(u){console.log(u)}return n.unitText&&(t+=n.unitText.toString()),a?"-":t}}]).directive("angularTable",function(){return{restrict:"EA",scope:{tableParams:"="},replace:!0,template:'<div class="table-responsive table-wrapper">   <angular-table-content table-list="tableParams.tableList" table-settings="tableParams.tableSettings" table-options="tableParams.tableOptions">   </angular-table-content>   <div class="resize-bar"></div>',link:function(t,e,n){}}}).directive("angularTableContent",["TableHelper","$document",function(t,e){return{restrict:"EA",scope:{tableList:"=",tableSettings:"=",tableOptions:"="},replace:!0,template:'<table class="table table-bordered table-hover table-striped">    <thead angular-table-header></thead>    <tbody angular-table-body></tbody></table>',link:function(t,e,n){t.gridScope=t.$parent.$parent}}}]).directive("angularTableHeader",["$document",function(t){return{restrict:"EA",replace:!0,template:'<thead class="table-header">   <tr>      <th class="th-checkbox" ng-show="::tableSettings.checkbox"><label><input type="checkbox" ng-model="selectAll" ng-change="checkAll()" /></label></th>      <th class="th-unit" data-th-key="{{::key}}" ng-if="!item.hidden" ng-repeat="(key,item) in tableOptions" ng-style="{\'width\':item.width}" ng-class="{\'sort\':key===col}">          <span class="inner" ng-click="sort(key)"><span class="table-sort"  ng-class="{true:\'down\', false: \'up\'}[desc]"><span class="icon-caret-up"></span><span class="icon-caret-down"></span></span>          <span class="th-inner" ng-bind="::item.ChineseName"></span></span>          <span class="th-resize" ng-mousedown="mousedown(key,$event)"></span>      </th>   </tr></thead>',link:function(e,n,a){e.col="",e.desc="",e.sort=function(t){e.col=t,e.desc=!e.desc};var i=$(n).closest(".table-wrapper");e.mousedown=function(n,a){function l(t){u.css({left:t.pageX-s.left+c})}function r(n){var a=(n.pageX,parseInt(u.offset().left)-d.offset().left),s=d.find(".inner").outerWidth()+10,a=Math.max(a,s),c=d.next(),p=c.data("th-key"),b=e.tableOptions[p],f=c.find(".inner");if(b.cellTemplate){var h=i.find("[data-td-key='"+p+"']").find(".td-inner"),g=0;h.each(function(){g=Math.max($(this).outerWidth(),g)});var m=Math.max(g+16,f.outerWidth()+10)}else var m=f.outerWidth()+10;var v=parseInt(e.tableOptions[p].width)+parseInt(e.tableOptions[o].width)-a;e.tableOptions[p].width=Math.max(v,m),e.tableOptions[o].width=a,e.$apply(),u.css({left:-999999999}),t.unbind("mousemove",l),t.unbind("mouseup",r)}a.preventDefault();var o=n,s=i.offset(),c=i.scrollLeft(),d=$(a.target).parent(),u=i.find(".resize-bar");a.pageX;t.bind("mousemove",l),t.bind("mouseup",r),u.css({left:a.pageX-s.left+c})},e.checkAll=function(){angular.forEach(e.tableList,function(t,n){t.checked=e.selectAll;var a=i.find("tbody tr").eq(n);a.toggleClass("selected",t.checked)})}}}}]).directive("angularTableBody",["$document","$timeout","TableHelper","$rootScope",function(t,e,n,a){return{restrict:"EA",replace:!0,template:'<tbody>   <tr class="table-row" tr="tr" key="key" table-list="tableList" tr-index="{{$index}}" table-settings="tableSettings" table-options="tableOptions" select-row="selectRow(tr,$index)" angular-table-tr ng-repeat="tr in tableList|orderBy:col:desc">   </tr></tbody>',link:function(t,a,i){var l=$(a).closest(".table-wrapper");t.selectRow=function(e,n){for(var a=!0,i=0;i<t.tableList.length;i++)if(!t.tableList[i].checked){a=!1;break}t.selectAll=a;var r=l.find("tbody tr").eq(n);r.toggleClass("selected",e.checked)};var r,o=n.throttle(function(){t.resizeUnitWidth(),t.$apply()},500);$(window).resize(o),$(window).on("window-resize",o),t.$watch("$parent.tableParams._watcherId",function(n,a){n!==a&&e(function(){r=angular.copy(t.tableOptions),t.resizeUnitWidth()},0)}),t.resizeUnitWidth=function(){if(t.tableList&&t.tableList.length>0){var e=120,n=0,a=t.tableSettings&&t.tableSettings.checkbox?40:0,i=l.width()-2;if(angular.forEach(r,function(e,i){if(!t.tableOptions[i].hidden)if("auto"!==r[i].width)a+=parseInt(t.tableOptions[i].width);else if(r[i].cellTemplate){var o=l.find("[data-th-key='"+i+"']").find(".th-inner"),s=l.find("[data-td-key='"+i+"']").find(".td-inner"),c=0;s.each(function(){c=Math.max($(this).outerWidth(!0),c)}),t.tableOptions[i].width=Math.max(c+16,o.outerWidth(),80,r[i].minWidth||0),a+=parseInt(t.tableOptions[i].width)}else n++}),0===n){for(var o in r)if(!t.tableOptions[o].hidden&&!r[o].cellTemplate){t.tableOptions[o].width=Math.max(i-(a-t.tableOptions[o].width),e,r[o].minWidth||0);break}}else for(var o in r)if(!t.tableOptions[o].hidden&&"auto"===r[o].width&&!r[o].cellTemplate){var s=(i-a)/n;t.tableOptions[o].width=Math.max(s,e,r[o].minWidth||0)}}}}}}]).directive("angularTableTr",["$document","$compile","$timeout",function(t,e,n){return{restrict:"EA",scope:{tr:"=",key:"=",tableSettings:"=",tableOptions:"=",selectRow:"&",tableList:"=",trIndex:"@"},link:function(t,a,i){t.gridScope=t.$parent.gridScope,t.$rowScope=t;var l,r=t.$parent,o=function(){l&&l.scope().$destroy();var n='<td class="td-checkbox" ng-show="::tableSettings.checkbox"><label><input type="checkbox" ng-model="tr.checked" ng-change="selectRow({tr:tr})" /></label></td><td data-td-key="{{::key}}" class="td-unit" ng-repeat="(key,td) in tr" ng-if="::tableOptions[key] && !tableOptions[key].hidden">   <div ng-if="::tableOptions[key].cellTemplate" td-compile="::td" class="td-inner td-tpl"></div>   <div ng-if="::!tableOptions[key].cellTemplate" ng-bind="::td|tdTrans:tableOptions[key]" title="{{::td|tdTrans:tableOptions[key]}}" class="td-inner td-text"></div></td>',i=angular.element(n);l=e(i)(t.$new()),a.html(i)};o();var s=function(){n(function(){r.resizeUnitWidth()},0)};t.refresh=function(){o(),s()},t.remove=function(){t.tableList.splice(t.trIndex,1),t.$destroy(),a.remove(),s()}}}}]).directive("tdCompile",["$compile",function(t){return function(e,n,a){e.$watch(function(t){return t.$eval(a.tdCompile)},function(a){n.html(a),t(n.contents())(e)})}}]);