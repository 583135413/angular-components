angular.module("ui.grid",["ngDatetime"]),angular.module("ui.grid").factory("TableFactory",["$rootScope",function(t){var e={};return e.defaultSettings={checkbox:!1,viewportNumbers:10},e.createTable=function(t,a){var n=angular.extend({},e.defaultSettings,t.settings),t=t.options,l={};for(var i in a[0])a[0].hasOwnProperty(i)&&!t[i]&&(l[i]={hidden:!0});t=angular.extend({},t,l);var r=function(){var e={};for(var a in t)angular.isFunction(t[a].hidden)&&(t[a].hidden=t[a].hidden()||!1),e[a]=angular.extend({},t[a]);return e},o=function(e){var a={};for(var n in t)a[n]=e[n];return a},s=function(){for(var t=[],e=0;e<a.length;e++){var n=o(a[e]);c(n),t.push(n)}return t},c=function(e){for(var a in t)t[a].cellTemplate&&(e[a]=t[a].cellTemplate())};return{refresh:function(){this._watcherId=(new Date).getTime()},_watcherId:(new Date).getTime(),tableSettings:n,tableOptions:r(),tableList:s()}},e}]),angular.module("ui.grid").factory("TableHelper",[function(){var t={};return t.sort=function(t,e,a,n){if(!t.length)return t;switch(a="desc"===a?"desc":"asc",n="[object Function]"===Object.prototype.toString.apply(n)?n:function(t){return t},Object.prototype.toString.apply(n.call({},t[0][e]))){case"[object Number]":return t.sort(function(t,l){return"asc"===a?n.call({},t[e])-n.call({},l[e]):n.call({},l[e])-n.call({},t[e])});case"[object String]":return t.sort(function(t,l){return"asc"===a?n.call({},t[e]).localeCompare(n.call({},l[e])):n.call({},l[e]).localeCompare(n.call({},t[e]))});default:return t}},t.throttle=function(t,e){var a=null;return function(){var n=this,l=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(n,l)},e)}},t.getScrollbarWidth=function(){var t=document.createElement("div");t.style.visibility="hidden",t.style.width="100px",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);var e=t.offsetWidth;t.style.overflow="scroll";var a=document.createElement("div");a.style.width="100%",t.appendChild(a);var n=a.offsetWidth;return t.parentNode.removeChild(t),e-n},t}]),angular.module("ui.grid").directive("angularTableBody",["$document","$timeout","TableHelper","$rootScope",function(t,e,a,n){return{restrict:"EA",replace:!0,template:'<tbody>   <tr ng-class="{selected:tr.checked}" class="table-row" tr="tr" key="key" table-list="tableList" tr-index="{{$index}}" table-settings="tableSettings" table-options="tableOptions" select-row="selectRow(tr,$index)" angular-table-row ng-repeat="tr in viewportList">   </tr></tbody>',link:function(t,e,a){t.selectRow=function(e,a){for(var n=!0,l=0;l<t.viewportList.length;l++)if(!t.viewportList[l].checked){n=!1;break}t.selectAll=n}}}}]),angular.module("ui.grid").directive("tableCellCompile",["$compile",function(t){return function(e,a,n){e.$watch(function(t){return t.$eval(n.tableCellCompile)},function(n){a.html(n),t(a.contents())(e)})}}]),angular.module("ui.grid").directive("angularTableContent",["TableHelper","$rootScope","$timeout",function(t,e,a){return{restrict:"EA",scope:{tableList:"=",tableSettings:"=",tableOptions:"="},replace:!0,template:'<div>   <div class="table-header-wrapper">       <table class="table table-bordered table-hover table-striped">           <thead class="table-header" angular-table-header></thead>       </table>   </div>   <div class="table-body-wrapper">       <div class="table-body-inner" ng-show="tableList.length">           <table class="table table-bordered table-hover table-striped">               <tbody class="table-body" angular-table-body></tbody>           </table>       </div>       <div class="table-body-empty" ng-show="tableList.length === 0">           <div class="table-body-empty-text">              <span class="icon icon-exclamation-sign"></span>              <span class="text" ng-bind="::tableSettings.emptyPlaceholder"></span>           </div>       </div>   </div></div>',link:function(e,n,l){e.gridScope=e.$parent.$parent;var i,r=$(n).closest(".table-wrapper"),o=$(n).find(".table-header-wrapper"),s=$(n).find(".table-body-wrapper"),c=s.find(".table-body-inner"),d=t.getScrollbarWidth(),u=40,p=120,b=e.tableSettings.viewportNumbers,h=!1,f=function(){var t=0,e=setTimeout(function(){s.css("left",0).scrollLeft(0),clearTimeout(e)},0);r.scrollLeft(0).on("scroll",function(e){var a=$(this).scrollLeft();t!==a&&(s.css("left",a),s.scrollLeft(a),t=a)})},g=e.renderViewportRows=function(t){var a="undefined"==typeof t?s.scrollTop():t,n=e.tableList.length*u;h=i<n,o.css("padding-right",h?d:0),s.css({"overflow-y":h?"auto":"hidden",height:b*u}),h||s.scrollTop(0),c.css({"padding-top":a,height:n});var l=Math.round(a/u);e.viewportList=e.tableList.slice(l,l+b)},m=function(){u=s.find(".table-row").outerHeight(),i=b*u,h=i<e.tableList.length*u,f(),g(0),y()},v=function(){var t=0;e.viewportList=e.tableList.slice(0,b),s.on("scroll",function(){var a=$(this).scrollTop(),n=(e.tableList.length-e.viewportList.length)*u;t!==a&&(g(Math.min(a,n)),t=Math.min(a,n),e.$digest())}),a(m,0)};e.$watch("$parent.tableParams._watcherId",function(t,e){t===e&&"undefined"==typeof t||v()});var w=t.throttle(function(){y(),e.$digest()},50);$(window).resize(w),$(window).on("window-resize",w);var y=e.resizeCellWidth=function(){var t=r.scrollLeft();s.scrollLeft()!==t&&r.scrollLeft(t-d);var a=angular.copy(e.tableOptions),n=0,l=e.tableSettings&&e.tableSettings.checkbox?40:0,i=h?r.width()-d-2:r.width()-2,o=function(t){e.tableOptions[t].width=Math.max(e.tableOptions[t].width,p,r.find("[data-th-key='"+t+"']").find(".inner").outerWidth()+10),l+=parseInt(e.tableOptions[t].width)},c=function(t){var n=r.find("[data-th-key='"+t+"']").find(".th-inner"),i=r.find("[data-td-key='"+t+"']").find(".td-inner"),o=0;i.each(function(){o=Math.max($(this).outerWidth(!0),o)}),e.tableOptions[t].width=Math.max(o+16,n.outerWidth(),80,a[t].minWidth||0),l+=parseInt(e.tableOptions[t].width)};angular.forEach(a,function(t,l){e.tableOptions[l].hidden||("auto"!==a[l].width?o(l):a[l].cellTemplate?c(l):n++)});var u=function(){for(var t in a)if(!e.tableOptions[t].hidden&&!a[t].cellTemplate){e.tableOptions[t].width=Math.max(i-(l-e.tableOptions[t].width),p,a[t].minWidth||0);break}},b=function(){for(var t in a)if(!e.tableOptions[t].hidden&&"auto"===a[t].width&&!a[t].cellTemplate){var r=(i-l)/n;e.tableOptions[t].width=Math.max(r,p,a[t].minWidth||0)}};0===n?u():b()}}}}]),angular.module("ui.grid").directive("angularTableHeader",["$document","TableHelper",function(t,e){return{restrict:"EA",replace:!0,template:'<thead>   <tr>      <th class="th-checkbox" ng-show="::tableSettings.checkbox"><label><input type="checkbox" ng-model="selectAll" ng-change="checkAll()" /></label></th>      <th class="th-unit" data-th-key="{{::key}}" ng-if="!item.hidden" ng-repeat="(key,item) in tableOptions" ng-style="{\'width\':item.width}" ng-class="{\'sort\':key===col}">          <span class="inner" ng-click="sort(key)"><span class="table-sort" ng-class="{true:\'down\', false: \'up\'}[desc]"><span class="icon-caret-up"></span><span class="icon-caret-down"></span></span>          <span class="th-inner" ng-bind="::item.ChineseName"></span></span>          <span class="th-resize" ng-mousedown="mousedown(key,$event)"></span>      </th>   </tr></thead>',link:function(a,n,l){a.col="";var i="asc";a.sort=function(t){i="asc"===i?"desc":"asc",a.tableList=e.sort(a.tableList,t,i),a.col=t,a.renderViewportRows(0)};var r=$(n).closest(".table-wrapper");a.mousedown=function(e,n){function l(t){u.css({left:t.pageX-s.left+c})}function i(e){var n=(e.pageX,parseInt(u.offset().left)-d.offset().left),s=d.find(".inner").outerWidth()+10,n=Math.max(n,s),c=d.next(),p=c.data("th-key"),b=a.tableOptions[p],h=c.find(".inner");if(b.cellTemplate){var f=r.find("[data-td-key='"+p+"']").find(".td-inner"),g=0;f.each(function(){g=Math.max($(this).outerWidth(),g)});var m=Math.max(g+16,h.outerWidth()+10)}else var m=h.outerWidth()+10;var v=parseInt(a.tableOptions[p].width)+parseInt(a.tableOptions[o].width)-n;a.tableOptions[p].width=Math.max(v,m),a.tableOptions[o].width=n,a.$apply(),u.css({left:-999999999}),t.unbind("mousemove",l),t.unbind("mouseup",i)}n.preventDefault();var o=e,s=r.offset(),c=r.scrollLeft(),d=$(n.target).parent(),u=r.find(".resize-bar");n.pageX;t.bind("mousemove",l),t.bind("mouseup",i),u.css({left:n.pageX-s.left+c})},a.checkAll=function(){angular.forEach(a.tableList,function(t,e){t.checked=a.selectAll})}}}}]),angular.module("ui.grid").directive("angularTableRow",["$document","$compile","$timeout",function(t,e,a){return{restrict:"EA",scope:{tr:"=",key:"=",tableSettings:"=",tableOptions:"=",selectRow:"&",tableList:"=",trIndex:"@"},link:function(t,a,n){t.gridScope=t.$parent.gridScope,t.$rowScope=t;var l,i=t.$parent,r=function(){l&&l.scope().$destroy();var n='<td class="td-checkbox" ng-show="::tableSettings.checkbox"><label><input type="checkbox" ng-model="tr.checked" ng-change="selectRow({tr:tr})" /></label></td><td data-td-key="{{::key}}" class="td-unit" ng-repeat="(key,td) in tr" ng-if="::tableOptions[key] && !tableOptions[key].hidden" ng-style="{\'width\':tableOptions[key].width}">   <div ng-if="::tableOptions[key].cellTemplate" table-cell-compile="::td" class="td-inner td-tpl"></div>   <div ng-if="::!tableOptions[key].cellTemplate" ng-bind="::td|tableCellTrans:tableOptions[key]" title="{{::td|tableCellTrans:tableOptions[key]}}" class="td-inner td-text"></div></td>',i=angular.element(n);l=e(i)(t.$new()),a.html(i)};r();var o=function(){for(var e=0;e<t.tableList.length;e++)if(t.tableList[e].$$hashKey===t.tr.$$hashKey)return e};t.refresh=function(){t.tableList.splice(o(),1,angular.copy(t.tr)),i.renderViewportRows(),i.resizeCellWidth()},t.remove=function(){t.tableList.splice(o(),1),t.$destroy(),i.renderViewportRows(),i.resizeCellWidth()}}}}]),angular.module("ui.grid").directive("angularTable",function(){return{restrict:"EA",scope:{tableParams:"="},replace:!0,template:'<div class="table-responsive table-wrapper">   <angular-table-content table-list="tableParams.tableList" table-settings="tableParams.tableSettings" table-options="tableParams.tableOptions">   </angular-table-content>   <div class="resize-bar"></div></div>',link:function(t,e,a){}}}),angular.module("ui.grid").filter("tableCellTrans",["dateTimeFactory",function(t){return function(e,a){var n=null===e||""===e;if(a.transValue){var l;if(angular.isFunction(a.transValue)){for(var i=a.transValue(),r={},o=i.list,s=i.key,c=i.value,d=0;d<o.length;d++)r[o[d][s]]=o[d][c];l=r[e]}else l=a.transValue[e];e=l||"-"}if(a.formatDate)try{e=t.format(t.newDate(e),a.formatDate)}catch(u){e="-"}if(a.toFixed)try{e=angular.isNumber(Number(e))&&!angular.equals(NaN,Number(e))?Number(e).toFixed(a.toFixed):"-"}catch(u){console.log(u)}return a.unitText&&(e+=a.unitText.toString()),n?"-":e}}]);